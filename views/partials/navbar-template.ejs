<!-- 
    NEW NAVBAR TEMPLATE
    ====================
    This is the updated navbar structure with hover dropdowns.
    Apply this structure to all pages to maintain consistency.
    
    Key changes:
    1. Events, About, and Dashboard (when logged in) now have hover dropdowns
    2. Dashboard only appears when logged in
    3. Profile dropdown only has Account Info and Logout
    4. Add class "navbar-static" to pages where navbar should always be visible
-->

<!-- Navigation -->
<nav class="navbar navbar-static">
    <div class="nav-container">
        <!-- Hamburger Menu Button (Mobile Only) -->
        <button class="hamburger-menu" aria-label="Toggle navigation menu" aria-expanded="false" id="hamburger-btn">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>
        
        <ul class="nav-menu" id="nav-menu">
            <!-- Events Dropdown -->
            <li class="nav-dropdown">
                <a href="/events" class="nav-dropdown-trigger" aria-expanded="false" aria-haspopup="true" aria-controls="events-dropdown" id="events-trigger">Events</a>
                <div class="nav-dropdown-content" id="events-dropdown" role="menu" aria-labelledby="events-trigger">
                    <a href="/events?filter=upcoming" role="menuitem">Upcoming Events</a>
                    <a href="/events?filter=past" role="menuitem">Past Events</a>
                </div>
            </li>
            <!-- About Dropdown -->
            <li class="nav-dropdown">
                <a href="/about" class="nav-dropdown-trigger" aria-expanded="false" aria-haspopup="true" aria-controls="about-dropdown" id="about-trigger">About</a>
                <div class="nav-dropdown-content" id="about-dropdown" role="menu" aria-labelledby="about-trigger">
                    <a href="/about#mission-vision" role="menuitem">Mission & Vision</a>
                    <a href="/about#programs" role="menuitem">Programs</a>
                    <a href="/about#mariachi" role="menuitem">Mariachi</a>
                    <a href="/about#ballet" role="menuitem">Ballet Folklorico</a>
                    <a href="/about#steam" role="menuitem">STEAM Workshops</a>
                    <a href="/about#summit" role="menuitem">Ella Rises Summit</a>
                    <a href="/about#contact" role="menuitem">Contact Us</a>
                </div>
            </li>
            <li><a href="/donate">Donate</a></li>
        </ul>
        <div class="nav-logo">
            <h1><a href="/" style="text-decoration: none; color: inherit;">ELLA RISES</a></h1>
        </div>
        <% if (isLoggedIn) { %>
            <div class="nav-auth">
                <div class="user-dropdown">
                    <button class="user-dropdown-btn" aria-expanded="false" aria-haspopup="true" aria-controls="user-dropdown-menu" id="user-menu-trigger">
                        <%= first_name %> <%= last_name %> â–¼
                    </button>
                    <div class="user-dropdown-content" id="user-dropdown-menu" role="menu" aria-labelledby="user-menu-trigger">
                        <a href="/dashboard" role="menuitem">User Dashboard</a>
                        <a href="/account-info" role="menuitem">Account Info</a>
                        <form action="/logout" method="POST" class="dropdown-logout-form">
                            <button type="submit" class="dropdown-logout-btn" role="menuitem">Logout</button>
                        </form>
                    </div>
                </div>
            </div>
        <% } else { %>
            <div class="nav-auth">
                <a href="/login" class="btn-signin">Sign In</a>
                <a href="/register" class="btn-signup">Sign Up</a>
            </div>
        <% } %>
    </div>
</nav>

<!-- 
    JAVASCRIPT TO ADD TO EACH PAGE
    ==============================
    Add this script before </body> tag.
    Note: No hide-on-scroll behavior since navbar is static.
-->
<script>
    // Mobile menu and touch-friendly dropdowns
    document.addEventListener('DOMContentLoaded', function() {
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const navMenu = document.getElementById('nav-menu');
        
        // Create overlay for mobile menu
        const overlay = document.createElement('div');
        overlay.className = 'nav-menu-overlay';
        document.body.appendChild(overlay);

        // Hamburger menu toggle
        if (hamburgerBtn && navMenu) {
            function toggleMobileMenu() {
                const isExpanded = hamburgerBtn.getAttribute('aria-expanded') === 'true';
                hamburgerBtn.setAttribute('aria-expanded', !isExpanded);
                navMenu.classList.toggle('active');
                overlay.classList.toggle('active');
                document.body.style.overflow = !isExpanded ? 'hidden' : '';
            }

            hamburgerBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                toggleMobileMenu();
            });

            // Close menu when clicking overlay
            overlay.addEventListener('click', function() {
                hamburgerBtn.setAttribute('aria-expanded', 'false');
                navMenu.classList.remove('active');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            });

            // Keyboard support for hamburger
            hamburgerBtn.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    toggleMobileMenu();
                } else if (e.key === 'Escape') {
                    hamburgerBtn.setAttribute('aria-expanded', 'false');
                    navMenu.classList.remove('active');
                    overlay.classList.remove('active');
                    document.body.style.overflow = '';
                    hamburgerBtn.focus();
                }
            });

            // Close menu on window resize if it becomes desktop
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    hamburgerBtn.setAttribute('aria-expanded', 'false');
                    navMenu.classList.remove('active');
                    overlay.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        }

        // User dropdown functionality (click-based for profile)
        const userDropdown = document.querySelector('.user-dropdown');
        const dropdownBtn = document.querySelector('.user-dropdown-btn');
        const dropdownContent = document.querySelector('.user-dropdown-content');
        
        if (dropdownBtn) {
            // Toggle dropdown
            function toggleDropdown() {
                const isExpanded = dropdownBtn.getAttribute('aria-expanded') === 'true';
                dropdownBtn.setAttribute('aria-expanded', !isExpanded);
                userDropdown.classList.toggle('active');
            }
            
            dropdownBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                toggleDropdown();
            });
            
            // Keyboard support
            dropdownBtn.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    toggleDropdown();
                    if (dropdownContent) {
                        const firstItem = dropdownContent.querySelector('a, button');
                        if (firstItem) firstItem.focus();
                    }
                } else if (e.key === 'Escape') {
                    dropdownBtn.setAttribute('aria-expanded', 'false');
                    userDropdown.classList.remove('active');
                    dropdownBtn.focus();
                }
            });
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (userDropdown && !userDropdown.contains(e.target)) {
                if (dropdownBtn) {
                    dropdownBtn.setAttribute('aria-expanded', 'false');
                    userDropdown.classList.remove('active');
                }
            }
        });
        
        // Navigation dropdown - Touch-friendly (click/tap support)
        const navDropdowns = document.querySelectorAll('.nav-dropdown');
        navDropdowns.forEach(dropdown => {
            const trigger = dropdown.querySelector('.nav-dropdown-trigger');
            const content = dropdown.querySelector('.nav-dropdown-content');
            const menuItems = content ? content.querySelectorAll('a[role="menuitem"]') : [];
            
            if (trigger && content) {
                // Detect if device is touch-enabled
                const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
                
                // Toggle dropdown function
                function toggleNavDropdown(e) {
                    if (e) {
                        e.preventDefault();
                        e.stopPropagation();
                    }
                    const isExpanded = trigger.getAttribute('aria-expanded') === 'true';
                    trigger.setAttribute('aria-expanded', !isExpanded);
                    
                    // Mobile: use class-based toggle
                    if (window.innerWidth <= 768) {
                        dropdown.classList.toggle('active');
                    } else {
                        // Desktop: use hover + click
                        if (!isExpanded) {
                            content.style.display = 'block';
                            content.style.opacity = '1';
                            content.style.visibility = 'visible';
                        } else {
                            content.style.display = 'none';
                            content.style.opacity = '0';
                            content.style.visibility = 'hidden';
                        }
                    }
                }
                
                // Click/tap support for touch devices
                trigger.addEventListener('click', function(e) {
                    // On mobile, always use click
                    if (window.innerWidth <= 768 || isTouchDevice) {
                        toggleNavDropdown(e);
                    }
                });
                
                // Desktop hover support (only on non-touch devices)
                if (!isTouchDevice) {
                    dropdown.addEventListener('mouseenter', function() {
                        if (window.innerWidth > 768) {
                            trigger.setAttribute('aria-expanded', 'true');
                            content.style.display = 'block';
                            content.style.opacity = '1';
                            content.style.visibility = 'visible';
                        }
                    });
                    
                    dropdown.addEventListener('mouseleave', function() {
                        if (window.innerWidth > 768) {
                            trigger.setAttribute('aria-expanded', 'false');
                            content.style.display = 'none';
                            content.style.opacity = '0';
                            content.style.visibility = 'hidden';
                        }
                    });
                }
                
                // Keyboard support for trigger
                trigger.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        toggleNavDropdown(e);
                        if (menuItems.length > 0) {
                            menuItems[0].focus();
                        }
                    } else if (e.key === 'Escape') {
                        trigger.setAttribute('aria-expanded', 'false');
                        if (window.innerWidth <= 768) {
                            dropdown.classList.remove('active');
                        } else {
                            content.style.display = 'none';
                            content.style.opacity = '0';
                            content.style.visibility = 'hidden';
                        }
                        trigger.focus();
                    } else if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        if (trigger.getAttribute('aria-expanded') === 'false') {
                            toggleNavDropdown(e);
                        }
                        if (menuItems.length > 0) {
                            menuItems[0].focus();
                        }
                    }
                });
                
                // Keyboard navigation within dropdown
                menuItems.forEach((item, index) => {
                    item.addEventListener('keydown', function(e) {
                        if (e.key === 'ArrowDown') {
                            e.preventDefault();
                            const nextIndex = (index + 1) % menuItems.length;
                            menuItems[nextIndex].focus();
                        } else if (e.key === 'ArrowUp') {
                            e.preventDefault();
                            const prevIndex = (index - 1 + menuItems.length) % menuItems.length;
                            menuItems[prevIndex].focus();
                        } else if (e.key === 'Escape') {
                            trigger.setAttribute('aria-expanded', 'false');
                            if (window.innerWidth <= 768) {
                                dropdown.classList.remove('active');
                            } else {
                                content.style.display = 'none';
                                content.style.opacity = '0';
                                content.style.visibility = 'hidden';
                            }
                            trigger.focus();
                        } else if (e.key === 'Home') {
                            e.preventDefault();
                            menuItems[0].focus();
                        } else if (e.key === 'End') {
                            e.preventDefault();
                            menuItems[menuItems.length - 1].focus();
                        }
                    });
                });
                
                // Close dropdown when focus leaves (desktop only)
                if (window.innerWidth > 768) {
                    dropdown.addEventListener('focusout', function(e) {
                        if (!dropdown.contains(e.relatedTarget)) {
                            trigger.setAttribute('aria-expanded', 'false');
                            content.style.display = 'none';
                            content.style.opacity = '0';
                            content.style.visibility = 'hidden';
                        }
                    });
                }
            }
        });
    });
</script>
